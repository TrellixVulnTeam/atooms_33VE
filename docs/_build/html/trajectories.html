
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Trajectories &#8212; atooms  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Simulations" href="simulations.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">atooms</a></h1>



<p class="blurb">A Python framework for simulations of interacting particles</p>






<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="basics.html">Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="simulations.html">Simulations</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Trajectories</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#custom-trajectory-output">Custom trajectory output</a></li>
<li class="toctree-l2"><a class="reference internal" href="#conversion-between-trajectory-formats">Conversion between trajectory formats</a></li>
<li class="toctree-l2"><a class="reference internal" href="#add-and-modify-trajectory-properties-on-the-fly-with-callbacks">Add and modify trajectory properties on the fly with callbacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#extend-trajectory-classes">Extend trajectory classes</a></li>
</ul>
</li>
</ul>


<hr />
<ul>
    
    <li class="toctree-l1"><a href="https://atooms.frama.io/atooms/">Notebooks on Binder</a></li>
    
    <li class="toctree-l1"><a href="https://atooms.frama.io/atooms/">Source code on Framagit</a></li>
    
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="simulations.html" title="previous chapter">Simulations</a></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="trajectories">
<h1>Trajectories<a class="headerlink" href="#trajectories" title="Permalink to this headline"></a></h1>
<section id="custom-trajectory-output">
<h2>Custom trajectory output<a class="headerlink" href="#custom-trajectory-output" title="Permalink to this headline"></a></h2>
<p>We can customize the format of trajectory files using the <code class="docutils literal notranslate"><span class="pre">fields</span></code> variable. It contains a list of the particle properties to be written to the trajectory. For this simple example we use again the xyz trajectory format.</p>
<p>We add a <code class="docutils literal notranslate"><span class="pre">charge</span></code> property to each particle and then instruct the trajectory to write it along with the position</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">atooms.system</span> <span class="kn">import</span> <span class="n">System</span><span class="p">,</span> <span class="n">Cell</span><span class="p">,</span> <span class="n">Particle</span>
<span class="n">system</span> <span class="o">=</span> <span class="n">System</span><span class="p">(</span><span class="n">particle</span><span class="o">=</span><span class="p">[</span><span class="n">Particle</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)],</span>
            <span class="n">cell</span><span class="o">=</span><span class="n">Cell</span><span class="p">([</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">]))</span>

<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">system</span><span class="o">.</span><span class="n">particle</span><span class="p">:</span>
    <span class="n">p</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>

<span class="k">with</span> <span class="n">TrajectoryXYZ</span><span class="p">(</span><span class="s1">&#39;test.xyz&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">,</span> <span class="s1">&#39;charge&#39;</span><span class="p">])</span> <span class="k">as</span> <span class="n">th</span><span class="p">:</span>
    <span class="n">th</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;test.xyz&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">fh</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">3</span>
<span class="n">step</span><span class="p">:</span><span class="mi">0</span> <span class="n">columns</span><span class="p">:</span><span class="n">position</span><span class="p">,</span><span class="n">charge</span> <span class="n">dt</span><span class="p">:</span><span class="mi">1</span> <span class="n">cell</span><span class="p">:</span><span class="mf">10.0</span><span class="p">,</span><span class="mf">10.0</span><span class="p">,</span><span class="mf">10.0</span>
<span class="mf">0.000000</span> <span class="mf">0.000000</span> <span class="mf">0.000000</span> <span class="o">-</span><span class="mf">1.0</span>
<span class="mf">0.000000</span> <span class="mf">0.000000</span> <span class="mf">0.000000</span> <span class="o">-</span><span class="mf">1.0</span>
<span class="mf">0.000000</span> <span class="mf">0.000000</span> <span class="mf">0.000000</span> <span class="o">-</span><span class="mf">1.0</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">fields</span></code> list can contain any particle property, even those defined dynamically at run time, such as the <code class="docutils literal notranslate"><span class="pre">charge</span></code> variable above which is not a predefined particle property!. When reading back the trajectory, the <code class="docutils literal notranslate"><span class="pre">charge</span></code> property is automatically recognized and added to the particle.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">TrajectoryXYZ</span><span class="p">(</span><span class="s1">&#39;test.xyz&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">th</span><span class="p">:</span>
  <span class="n">system</span> <span class="o">=</span> <span class="n">th</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">particle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">charge</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="mf">1.0</span>
</pre></div>
</div>
</section>
<section id="conversion-between-trajectory-formats">
<h2>Conversion between trajectory formats<a class="headerlink" href="#conversion-between-trajectory-formats" title="Permalink to this headline"></a></h2>
<p>Atooms provides means to convert between trajectory various formats. At a very basic level, this requires opening the original trajectory for reading and the new one for writing using the desired trajectory class. Here we convert an xyz trajectory in a format suitable for the LAMMPS package</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">atooms.trajectory</span> <span class="kn">import</span> <span class="n">TrajectoryLAMMPS</span>
<span class="k">with</span> <span class="n">TrajectoryXYZ</span><span class="p">(</span><span class="s1">&#39;test.xyz&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">th_inp</span><span class="p">,</span>\
     <span class="n">TrajectoryLAMMPS</span><span class="p">(</span><span class="s1">&#39;test.lammps&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">th_out</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">system</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">th_inp</span><span class="p">):</span>
        <span class="n">th_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">th_inp</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">convert()</span></code> function wraps the conversion in a more convenient interface</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">atooms.trajectory</span> <span class="kn">import</span> <span class="n">convert</span>
<span class="n">convert</span><span class="p">(</span><span class="n">TrajectoryXYZ</span><span class="p">(</span><span class="s1">&#39;test.xyz&#39;</span><span class="p">),</span> <span class="n">TrajectoryLAMMPS</span><span class="p">,</span> <span class="s1">&#39;test.lammps&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>There are several optional parameters that allows to customize the trajectory output, see the function signature for more details.</p>
<p>Finally, the <code class="docutils literal notranslate"><span class="pre">trj.py</span></code> script installed by atooms allows to quickly convert trajectories on the command-line, which is actually the most frequent use case</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>trj.py convert -i xyz -o lammps test.xyz test.lammps
</pre></div>
</div>
<p>Although the script will do its best to guess the appropriate trajectory formats, it is best to provide the input and output trajectory formats via the <code class="docutils literal notranslate"><span class="pre">-i</span></code> and <code class="docutils literal notranslate"><span class="pre">-o</span></code> flags explicitly.</p>
</section>
<section id="add-and-modify-trajectory-properties-on-the-fly-with-callbacks">
<h2>Add and modify trajectory properties on the fly with callbacks<a class="headerlink" href="#add-and-modify-trajectory-properties-on-the-fly-with-callbacks" title="Permalink to this headline"></a></h2>
<p>“Callbacks” are functions used to modify the properties of a trajectory on the fly. They accept a <code class="docutils literal notranslate"><span class="pre">System</span></code> instance as first positional argument, along with optional extra positional and keyword arguments, and return a modified <code class="docutils literal notranslate"><span class="pre">System</span></code>.</p>
<p>As an example, suppose your trajectory did not provide any information about the cell side. You can add the information dynamically to all <code class="docutils literal notranslate"><span class="pre">System</span></code> objects read from the trajectory using the following callback</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">atooms.system</span> <span class="kn">import</span> <span class="n">Cell</span>
<span class="k">def</span> <span class="nf">fix_missing_cell</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">side</span><span class="p">):</span>
    <span class="n">system</span><span class="o">.</span><span class="n">cell</span> <span class="o">=</span> <span class="n">Cell</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">system</span>
</pre></div>
</div>
<p>Then we add the callback to the trajectory and provide the cell side (here L=10 along each dimensions) as argument. Reading the trajectory is then done as usual.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">atooms.trajectory</span> <span class="kn">import</span> <span class="n">TrajectoryXYZ</span>
<span class="k">with</span> <span class="n">TrajectoryXYZ</span><span class="p">(</span><span class="s1">&#39;test.xyz&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">th</span><span class="p">:</span>
    <span class="n">th</span><span class="o">.</span><span class="n">add_callback</span><span class="p">(</span><span class="n">fix_missing_cell</span><span class="p">,</span> <span class="p">[</span><span class="mf">10.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">system</span> <span class="ow">in</span> <span class="n">th</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">side</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mf">10.</span> <span class="mf">10.</span> <span class="mf">10.</span><span class="p">]</span>
<span class="p">[</span><span class="mf">10.</span> <span class="mf">10.</span> <span class="mf">10.</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="extend-trajectory-classes">
<h2>Extend trajectory classes<a class="headerlink" href="#extend-trajectory-classes" title="Permalink to this headline"></a></h2>
<p>Suppose you have a trajectory that looks almost like xyz, but differs in some way. You may want to customize the xyz trajectory format, so that your code can process the trajectory without manual intervention.</p>
<p>For instance, your xyz file is <code class="docutils literal notranslate"><span class="pre">test.xyz</span></code> but the cell side information is stored in a separate file <code class="docutils literal notranslate"><span class="pre">test.xyz.cell</span></code>. We can proceed as before</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">atooms.system</span> <span class="kn">import</span> <span class="n">Cell</span>

<span class="n">file_inp</span> <span class="o">=</span> <span class="s1">&#39;test.xyz&#39;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_inp</span> <span class="o">+</span> <span class="s1">&#39;.cell&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
    <span class="c1"># Assume the cell file contains a string Lx Ly Lz</span>
    <span class="c1"># where Lx, Ly, Lz are the sides of the orthorombic cell</span>
    <span class="n">side</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">L</span><span class="p">)</span> <span class="k">for</span> <span class="n">L</span> <span class="ow">in</span> <span class="n">fh</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>

<span class="k">with</span> <span class="n">TrajectoryXYZ</span><span class="p">(</span><span class="n">file_inp</span><span class="p">)</span> <span class="k">as</span> <span class="n">th</span><span class="p">:</span>
    <span class="n">th</span><span class="o">.</span><span class="n">add_callback</span><span class="p">(</span><span class="n">fix_missing_cell</span><span class="p">,</span> <span class="n">side</span><span class="p">)</span>
</pre></div>
</div>
<p>As a more permanent solution, you can define your own custom trajectory by subclassing <code class="docutils literal notranslate"><span class="pre">TrajectoryXYZ</span></code>. First, parse the cell information during the initialization stage (<code class="docutils literal notranslate"><span class="pre">read_init()</span></code>).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">atooms.system</span> <span class="kn">import</span> <span class="n">Cell</span>
<span class="kn">from</span> <span class="nn">atooms.trajectory</span> <span class="kn">import</span> <span class="n">TrajectoryXYZ</span>

<span class="k">class</span> <span class="nc">TrajectoryCustomXYZ</span><span class="p">(</span><span class="n">TrajectoryXYZ</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">read_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">read_init</span><span class="p">()</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.cell&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_side</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">L</span><span class="p">)</span> <span class="k">for</span> <span class="n">L</span> <span class="ow">in</span> <span class="n">fh</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
</pre></div>
</div>
<p>Then modify the <code class="docutils literal notranslate"><span class="pre">read_sample()</span></code> method, which reads a given frame of the trajectory.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">read_sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
    <span class="n">system</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">read_sample</span><span class="p">()</span>
    <span class="n">system</span><span class="o">.</span><span class="n">cell</span> <span class="o">=</span> <span class="n">Cell</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_side</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">system</span>
</pre></div>
</div>
<p>Here we have assumed that the cell side is the same for all frames. The code would have to be adjusted to the more general case of a fluctuating cell.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2022, Daniele Coslovich.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.3.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/trajectories.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>